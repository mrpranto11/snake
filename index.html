<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Snake Game Pro</title>

<!-- VERY IMPORTANT FOR MOBILE -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:Arial, Helvetica, sans-serif;
}

body{
  background:#111;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}

.game{
  width:100%;
  max-width:420px;
  text-align:center;
  padding:10px;
}

canvas{
  background:#000;
  border:3px solid #555;
  margin-top:8px;

  /* ===== RESPONSIVE FIX ===== */
  width:min(90vw, 400px);
  height:min(90vw, 400px);
  touch-action:none;
}

#hud{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:14px;
  margin-bottom:6px;
}

#gameOver{
  color:red;
  margin-top:10px;
  display:none;
  font-weight:bold;
}

/* Color Picker */
input[type=color]{
  border:none;
  background:none;
  width:40px;
  height:30px;
  cursor:pointer;
}

/* ===== MOBILE CONTROLS ===== */
#controls{
  margin-top:14px;
  text-align:center;
}

#controls button{
  width:60px;
  height:60px;
  margin:6px;
  font-size:22px;
  border-radius:50%;
  border:none;
  background:#222;
  color:#fff;
}

#controls button:active{
  background:#00ff88;
  color:#000;
}

/* Hide only on non-touch desktop */
@media (hover: hover) and (pointer: fine) {
  #controls{
    display:none;
  }
}

</style>
</head>

<body>

<div class="game">
  <h2>üêç Snake Game Pro</h2>

  <div id="hud">
    <div>
      Score: <span id="score">0</span> |
      High: <span id="high">0</span>
    </div>
    <div>
      üé® <input type="color" id="colorPicker" value="#00ff88">
    </div>
  </div>

  <canvas id="c" width="400" height="400"></canvas>

  <div id="gameOver">Game Over ‚Äî Press ENTER</div>

  <!-- Mobile Buttons -->
  <div id="controls">
    <button data-dir="up">‚¨ÜÔ∏è</button>
    <div>
      <button data-dir="left">‚¨ÖÔ∏è</button>
      <button data-dir="down">‚¨áÔ∏è</button>
      <button data-dir="right">‚û°Ô∏è</button>
    </div>
  </div>
</div>

<script>
const c = document.getElementById("c");
const ctx = c.getContext("2d");

const GRID = 20;
const SIZE = 20;

let snake, food, dir, nextDir, score, loop;
let speed = 120;
let snakeColor = "#00ff88";

let highScore = localStorage.getItem("snakeHigh") || 0;
document.getElementById("high").innerText = highScore;

/* ===== RESET ===== */
function reset(){
  snake = [
    {x:10,y:10},
    {x:9,y:10},
    {x:8,y:10}
  ];
  dir = nextDir = {x:1,y:0};
  score = 0;
  speed = 120;

  document.getElementById("score").innerText = score;
  document.getElementById("gameOver").style.display = "none";

  spawnFood();
  clearInterval(loop);
  loop = setInterval(update, speed);
}

/* ===== UPDATE ===== */
function update(){
  move();
  draw();
}

/* ===== DRAW ===== */
function draw(){
  ctx.clearRect(0,0,400,400);

  ctx.fillStyle = snakeColor;
  snake.forEach(s=>{
    ctx.fillRect(s.x*SIZE, s.y*SIZE, SIZE, SIZE);
  });

  ctx.fillStyle = "red";
  ctx.fillRect(food.x*SIZE, food.y*SIZE, SIZE, SIZE);
}

/* ===== MOVE ===== */
function move(){
  dir = nextDir;
  const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
  snake.unshift(head);

  if(head.x<0 || head.y<0 || head.x>=GRID || head.y>=GRID){
    end(); return;
  }

  for(let i=1;i<snake.length;i++){
    if(head.x===snake[i].x && head.y===snake[i].y){
      end(); return;
    }
  }

  if(head.x===food.x && head.y===food.y){
    score+=10;
    document.getElementById("score").innerText=score;

    if(score>highScore){
      highScore=score;
      localStorage.setItem("snakeHigh", highScore);
      document.getElementById("high").innerText=highScore;
    }
    spawnFood();
  }else{
    snake.pop();
  }
}

/* ===== FOOD ===== */
function spawnFood(){
  let x,y,safe=false;
  while(!safe){
    x=Math.floor(Math.random()*GRID);
    y=Math.floor(Math.random()*GRID);
    safe=!snake.some(s=>s.x===x && s.y===y);
  }
  food={x,y};
}

/* ===== GAME OVER ===== */
function end(){
  clearInterval(loop);
  document.getElementById("gameOver").style.display="block";
}

/* ===== KEYBOARD ===== */
document.addEventListener("keydown", e=>{
  if(e.key==="ArrowUp" && dir.y===0) nextDir={x:0,y:-1};
  if(e.key==="ArrowDown" && dir.y===0) nextDir={x:0,y:1};
  if(e.key==="ArrowLeft" && dir.x===0) nextDir={x:-1,y:0};
  if(e.key==="ArrowRight" && dir.x===0) nextDir={x:1,y:0};
  if(e.key==="Enter") reset();
});

/* ===== SWIPE ===== */
let sx, sy;
c.addEventListener("touchstart", e=>{
  sx=e.touches[0].clientX;
  sy=e.touches[0].clientY;
});

c.addEventListener("touchend", e=>{
  let dx=e.changedTouches[0].clientX-sx;
  let dy=e.changedTouches[0].clientY-sy;

  if(Math.abs(dx)>Math.abs(dy)){
    if(dx>0 && dir.x===0) nextDir={x:1,y:0};
    else if(dx<0 && dir.x===0) nextDir={x:-1,y:0};
  }else{
    if(dy>0 && dir.y===0) nextDir={x:0,y:1};
    else if(dy<0 && dir.y===0) nextDir={x:0,y:-1};
  }
});

/* ===== BUTTONS ===== */
document.querySelectorAll("#controls button").forEach(btn=>{
  btn.addEventListener("touchstart",()=>{
    const d=btn.dataset.dir;
    if(d==="up" && dir.y===0) nextDir={x:0,y:-1};
    if(d==="down" && dir.y===0) nextDir={x:0,y:1};
    if(d==="left" && dir.x===0) nextDir={x:-1,y:0};
    if(d==="right" && dir.x===0) nextDir={x:1,y:0};
  });
});

/* ===== COLOR ===== */
document.getElementById("colorPicker").addEventListener("input",e=>{
  snakeColor=e.target.value;
});

reset();
</script>

</body>
</html>
